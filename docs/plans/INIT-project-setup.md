# Workplan: Initial Project Setup

**Task ID**: `INIT-project-setup`

## Problem Statement

Complete the initial project setup as outlined in `plan.md`, starting from Step 2 (Lexicon setup), as Step 1 (Scaffolding) is already complete. This involves creating the necessary lexicon files and generating corresponding TypeScript types.

## Components Involved

* `plan.md` (for reference)
* `lexicons/` directory
* `lexicons/blue.snippet.code.json` (lexicon definition)
* `package.json` (for dev dependencies)
* `src/lexicon-types.ts` (generated types)
* `docs/plans/INIT-project-setup.md` (this file)

## Dependencies

* Base project structure (assumed from completed Step 1 of `plan.md`)
* `pnpm` (Node package manager)
* Node.js environment
* `@atproto/lex-cli` (to be installed)

## Implementation Checklist

* [X] Create `docs/plans/INIT-project-setup.md` (this file)
* [X] Create the `lexicons/` directory.
* [X] Create `lexicons/blue.snippet.code.json` with content from `plan.md` (Section 3).
* [X] Add `@atproto/lex-cli` as a dev dependency using `pnpm add -D @atproto/lex-cli`.
* [X] Add `lex:gen` script to `package.json` if not present: `"lex:gen": "lex gen-ts-obj lexicons/blue.snippet.code.json > src/lexicon-types.ts"`
* [X] Run `pnpm lex:gen` to generate lexicon types.
* [X] Verify successful type generation (Note: Will require a new method for .ts files, e.g., using ts-node).

## Verification Steps

* `docs/plans/INIT-project-setup.md` exists.
* `lexicons/` directory exists.
* `lexicons/blue.snippet.code.json` exists and contains the correct JSON content.
* `@atproto/lex-cli` is listed under `devDependencies` in `package.json`.
* The `lex:gen` script is present in `package.json` scripts.
* `src/lexicon-types.ts` is generated by `pnpm lex:gen`.
* The command `npx ts-node -e "require('./src/lexicon-types'); console.log('TypeScript types ok')"` executes successfully, confirming the types are valid.

## Decision Authority

* **Cascade**: Can create directories and files as specified in `plan.md`. Can install required npm packages.
* **User**: Approval for any deviations from `plan.md` or unexpected issues.

## Questions/Uncertainties

### Blocking

* None currently anticipated.

### Non-blocking

* Assuming `pnpm` and `node` (version â‰¥20 as per `plan.md`) are installed and accessible in the system's PATH.
* Assuming the `package.json` file exists at the root of the project.

## Acceptable Tradeoffs

* N/A for this initial setup phase.

## Status

Completed

## Notes

* This workplan directly follows the "Atomic Steps" outlined in `plan.md`.
* Step 1 (`Scaffold (Next + Workers)`) is confirmed as already completed.
* Initial `pnpm` execution failed due to potential version mismatch or PATH issues. Resolved by using `npx pnpm@9.1.0 ...` (matching version from `packageManager` field in `package.json`).
* Correct AT Protocol CLI package is `@atproto/lex-cli`, not `@atproto/cli`.
* Lexicon JSON structure required several corrections to match schema expectations (e.g., `defs.main.record.type` must be `"object"`).
* Initial verification `node -e "require('./src/lexicon-types')"` failed for `.ts` output. Switched to `.js` temporarily.
* Per user request, switching back to `.ts` output for lexicons. A new verification method (e.g., using `ts-node`) will be implemented.
